<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8" />
    <title>Mocha Tests</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="mocha.css" />
  </head>
  <body>
    <div id="mocha"></div>

    <script src="chai.js"></script>
    <script src="mocha.js"></script>


    <script class="mocha-init">
      mocha.setup('bdd');
      mocha.checkLeaks();
      
    </script>
    <script type="module">
      import documentElementData from './../documentElementData.js'
      import {  _getDocumentElementById,
                _getFlatDocumentData,
                _getElementPositionOnCanvas,
                _getParentChain
        } from './../documentElementsHelpers.js'

      const it = Mocha.it;
      const describe = Mocha.describe;
      
      describe('_getDocumentElementById', function () {
        it('should return the document object with the id', function () {
            //get a non-root object: 
            const documentObject = documentElementData.children[1]
            //get its id
            const documentObjectId = documentObject.id 

            chai.expect(
                _getDocumentElementById(documentElementData,documentObjectId)
              ).to.equal(
                documentObject
              );
        });
      });


      describe('_getFlatDocumentData', function(){
        const flatData = _getFlatDocumentData(documentElementData); 
        it('should be an array', function(){
          chai.expect(flatData).to.be.an('Array');
        })
      });

      describe('_getParentChain', function(){
        const nestedData = {
          'id': 'documentElementsRootNode',
          'children':[
            {
            'id':'2', 
            'children':[
              {'id':'1',
               'children':[] 
              }]
          }]
        }

        const parentChain = [
          {'id': '1','children':[]},
          {'id': '2','children':['1']}
        ];

        it('should return the parents', function(){
          chai.expect(_getParentChain(nestedData,'1')).to.eql(parentChain);
        })
      });

    describe('_getParentChain', function(){
      const nestedData = {
          'id': 'documentElementsRootNode',
          'children':[
            {
            'id':'2', 
            'pos_x':20, 
            'pos_y':30,
            'children':[
              {'id':'1',
                'pos_x':10,
                'pos_y':5,
               'children':[] 
              }]
          }]
        }

      it('should give the absolute position  by adding all offsets',function(){
        chai.expect(_getElementPositionOnCanvas(nestedData,'1')).to.eql({'pos_x_abs':30,'pos_y_abs':35});
      })
    });

    describe('_elementPointIsIn', function(){
      const nestedData = {
          'id': 'documentElementsRootNode',
          'children':[
            {
            'id':'1', 
            'pos_x':20, 
            'pos_y':31,
            'width':200,
            'height':151,
            'children':[
              {'id':'2',
                'pos_x':10,
                'pos_y':11,
                'width':40,
                'height':51,
                'children':[
                  {
                    id:'3',
                    'pos_x':10,
                    'pos_y':3,
                    'width':10,
                    'height':11,
                    'children':[]
                  }] 
              }]
          }]
        }

      const pointIn3 = {pos_x:50, pos_y:50}
      const pointIn1 = {pos_x:110, pos_y:150}
      
      it('should return the element under the point is a child of', function(){
        chai.expect(_elementPointIsIn(nestedData,pointIn3)).to.eql({id:'3','pos_x':10,'pos_y':3,'width':10,'height':11,'children':[]})
      });
    });


    </script>
    <script class="mocha-exec" type="module">
      mocha.run();
    </script>
  </body>
</html>
